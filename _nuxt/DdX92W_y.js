import{_ as E,r as f,J as C,K as z,o as I,v,x as a,y as l,L as U,M as k,N as r,t as h}from"./Dcd5bFKn.js";import{U as L}from"./BIbqvuFE.js";import{P as R}from"./C4YHeYHv.js";import{P as T}from"./ClhTlj9r.js";import{r as c}from"./UlRcRJ6H.js";import"./DRckOv8H.js";const $={class:"dashboard-container"},M={class:"title-container"},S={class:"polls-container"},V=["onClick"],H={class:"poll-title"},J={class:"poll-info"},K={__name:"index",setup(O){const g=L.abi,A="0x947FFf4A43074f3F83A3F127d62Bd65738b3406b",b=R.abi,P="0xC78375119f32206464D6Ef9b3064195991B4D244",i=T.abi,d=f({organization:"",contact:""}),p=f([]),m=f(!1),{address:s,isConnected:F}=C(),_=z(),N=()=>{c(r,{address:A,abi:g,functionName:"instances",args:[s.value]}).then(e=>{Array.isArray(e)?(d.value.organization=e[0]||"Unknown",d.value.contact=e[1]||"N/A",d.value.isActive=e[2]||!1):console.warn("Unexpected format for instance data:",e)}).catch(e=>{console.error("Error fetching instance data:",e)})},y=e=>{c(r,{address:P,abi:b,functionName:"getPollsByInstance",args:[s.value],account:s.value}).then(o=>{Array.isArray(o)?e(o):(console.warn("Unexpected format for poll addresses:",o),e([]))}).catch(o=>{console.error("Error fetching poll addresses:",o),e([])})},w=(e,o)=>{const t={};c(r,{address:e,abi:i,functionName:"pollTitle",account:s.value}).then(n=>(t.title=n||"Unknown",c(r,{address:e,abi:i,functionName:"endDate",account:s.value}))).then(n=>(t.endDate=n?new Date(Number(n)*1e3).toLocaleString():"N/A",c(r,{address:e,abi:i,functionName:"isFinalized",account:s.value}))).then(n=>(t.isFinalized=n||!1,c(r,{address:e,abi:i,functionName:"creator",account:s.value}))).then(n=>{t.creator=n||"Unknown",t.address=e,o(t)}).catch(n=>{console.error(`Failed to fetch poll data for ${e}:`,n),o(null)})},x=()=>{m.value=!0,y(e=>{const o=[];let t=0;e.forEach(n=>{w(n,u=>{u&&o.push(u),t+=1,t===e.length&&(p.value=o,m.value=!1)})})})};I(()=>{s.value&&F.value&&(N(),x())});const D=e=>{_.push(`/polls/${e}/data`)},B=()=>{_.push("/polls/new")};return(e,o)=>(h(),v("div",$,[a("div",M,[a("h1",null,"Hello "+l(d.value.organization||"Loading..."),1),o[0]||(o[0]=a("p",null,"View your Poll data or create new Polls.",-1))]),a("div",S,[(h(!0),v(U,null,k(p.value,(t,n)=>(h(),v("div",{key:n,class:"poll-row",onClick:u=>D(t.address)},[a("div",H,l(t.title),1),a("div",J,[a("div",null,"Creator: "+l(t.creator),1),a("div",null,"End Date: "+l(t.endDate),1),a("div",null,"Is Finalized: "+l(t.isFinalized?"Yes":"No"),1)])],8,V))),128))]),a("div",{class:"create-poll-container"},[a("button",{onClick:B,class:"create-poll-button"}," CREATE NEW POLL ")])]))}},X=E(K,[["__scopeId","data-v-662d63cb"]]);export{X as default};
