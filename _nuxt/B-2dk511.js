import{_ as U,r as p,J as L,K as R,o as V,v as b,x as i,y as v,L as O,M as T,N as a,t as _,O as M}from"./Dcd5bFKn.js";import{U as z}from"./BIbqvuFE.js";import{P as H}from"./C4YHeYHv.js";import{P as J}from"./ClhTlj9r.js";import{S as K}from"./DvOOLRGX.js";import{r as l}from"./UlRcRJ6H.js";import"./DRckOv8H.js";const j={class:"voter-dashboard"},q={class:"title-container"},G={class:"polls-container"},Q=["onClick"],W={class:"poll-title"},X={class:"poll-info"},Y={__name:"index",setup(Z){const P=z.abi,x="0x947FFf4A43074f3F83A3F127d62Bd65738b3406b",A=H.abi,N="0xC78375119f32206464D6Ef9b3064195991B4D244",y=K.abi,D="0xb88dc3530f6e330A1604388c62Ea01a104D4Edb6",u=J.abi,f=p({name:"",age:"",isActive:!1}),E=p([]),C=p(!1),{address:m,isConnected:B}=L(),F=R(),$=()=>{l(a,{address:x,abi:P,functionName:"users",args:[m.value]}).then(t=>{Array.isArray(t)?(f.value.name=t[0]||"Unknown",f.value.age=t[1]||"N/A",f.value.isActive=t[3]||!1):console.warn("Unexpected format for voter data:",t)}).catch(t=>{console.error("Error fetching voter data:",t)})},k=t=>{l(a,{address:N,abi:A,functionName:"getPollCount"}).then(s=>{const e=Number(s),n=[];let o=0;e===0&&t([]);for(let r=0;r<e;r++)l(a,{address:N,abi:A,functionName:"allPolls",args:[r]}).then(c=>{n.push(c),o++,o===e&&t(n)}).catch(c=>{console.error(`Error fetching poll address for index ${r}:`,c),o++,o===e&&t(n)})}).catch(s=>{console.error("Error fetching poll count:",s),t([])})},w=(t,s)=>{const e={};l(a,{address:t,abi:u,functionName:"pollTitle"}).then(o=>(e.title=o||"Unknown",l(a,{address:t,abi:u,functionName:"endDate"}))).then(o=>(e.endDate=o?new Date(Number(o)*1e3).toLocaleString():"N/A",l(a,{address:t,abi:u,functionName:"getTotalOptions"}))).then(o=>{const r=Number(o)||0;let c=0,d=0;if(r===0)return e.voterCount=0,n();for(let h=0;h<r;h++)l(a,{address:t,abi:u,functionName:"votingOptions",args:[h]}).then(g=>{c+=Number(g.voteCount||0),d++,d===r&&(e.voterCount=c,n())}).catch(g=>{console.error(`Error fetching vote count for option ${h}:`,g),d++,d===r&&(e.voterCount=c,n())})}).catch(o=>{console.error(`Error fetching poll details for ${t}:`,o),s(null)});function n(){l(a,{address:D,abi:y,functionName:"checkEligibility",args:[t,m.value]}).then(o=>{e.isEligible=o||!1,e.address=t,s(e)}).catch(o=>{console.error(`Error checking eligibility for ${t}:`,o),s(null)})}},I=()=>{C.value=!0,k(t=>{const s=[];let e=0;t.forEach(n=>{w(n,o=>{o&&s.push(o),e+=1,e===t.length&&(E.value=s,C.value=!1)})})})};V(()=>{m.value&&B.value&&($(),I())});const S=t=>{F.push(`/polls/${t}/vote`)};return(t,s)=>(_(),b("div",j,[i("div",q,[i("h1",null,"Hello "+v(f.value.name||"Loading..."),1),s[0]||(s[0]=i("p",null,"Subscribe to a Poll and Vote!",-1))]),i("div",G,[(_(!0),b(O,null,T(E.value,(e,n)=>(_(),b("div",{key:n,class:M(["poll-row",{eligible:e.isEligible}]),onClick:o=>S(e.address)},[i("div",W,v(e.title),1),i("div",X,[i("div",null,"Voters: "+v(e.voterCount),1),i("div",null,"Final Date: "+v(e.endDate),1)])],10,Q))),128))])]))}},at=U(Y,[["__scopeId","data-v-4656bab5"]]);export{at as default};
