import{_ as C,r as f,J as z,K as B,o as I,v,x as n,y as l,L as U,M as k,N as r,t as h}from"./maorzbmM.js";import{U as L}from"./BIbqvuFE.js";import{P as R}from"./C4YHeYHv.js";import{P as T}from"./ClhTlj9r.js";import{r as c}from"./CB_jOHdl.js";import"./DqVirlQw.js";const $={class:"dashboard-container"},M={class:"title-container"},S={class:"polls-container"},V=["onClick"],H={class:"poll-title"},J={class:"poll-info"},K={__name:"index",setup(O){const g=L.abi,A="0x9fE46736679d2D9a65F0992F2272dE9f3c7fa6e0",P=R.abi,N="0xDc64a140Aa3E981100a9becA4E685f962f0cF6C9",i=T.abi,d=f({organization:"",contact:""}),p=f([]),m=f(!1),{address:s,isConnected:b}=z(),_=B(),y=()=>{c(r,{address:A,abi:g,functionName:"instances",args:[s.value]}).then(e=>{Array.isArray(e)?(d.value.organization=e[0]||"Unknown",d.value.contact=e[1]||"N/A",d.value.isActive=e[2]||!1):console.warn("Unexpected format for instance data:",e)}).catch(e=>{console.error("Error fetching instance data:",e)})},E=e=>{c(r,{address:N,abi:P,functionName:"getPollsByInstance",args:[s.value],account:s.value}).then(o=>{Array.isArray(o)?e(o):(console.warn("Unexpected format for poll addresses:",o),e([]))}).catch(o=>{console.error("Error fetching poll addresses:",o),e([])})},F=(e,o)=>{const t={};c(r,{address:e,abi:i,functionName:"pollTitle",account:s.value}).then(a=>(t.title=a||"Unknown",c(r,{address:e,abi:i,functionName:"endDate",account:s.value}))).then(a=>(t.endDate=a?new Date(Number(a)*1e3).toLocaleString():"N/A",c(r,{address:e,abi:i,functionName:"isFinalized",account:s.value}))).then(a=>(t.isFinalized=a||!1,c(r,{address:e,abi:i,functionName:"creator",account:s.value}))).then(a=>{t.creator=a||"Unknown",t.address=e,o(t)}).catch(a=>{console.error(`Failed to fetch poll data for ${e}:`,a),o(null)})},w=()=>{m.value=!0,E(e=>{const o=[];let t=0;e.forEach(a=>{F(a,u=>{u&&o.push(u),t+=1,t===e.length&&(p.value=o,m.value=!1)})})})};I(()=>{s.value&&b.value&&(y(),w())});const x=e=>{_.push(`/polls/${e}/data`)},D=()=>{_.push("/polls/new")};return(e,o)=>(h(),v("div",$,[n("div",M,[n("h1",null,"Hello "+l(d.value.organization||"Loading..."),1),o[0]||(o[0]=n("p",null,"View your Poll data or create new Polls.",-1))]),n("div",S,[(h(!0),v(U,null,k(p.value,(t,a)=>(h(),v("div",{key:a,class:"poll-row",onClick:u=>x(t.address)},[n("div",H,l(t.title),1),n("div",J,[n("div",null,"Creator: "+l(t.creator),1),n("div",null,"End Date: "+l(t.endDate),1),n("div",null,"Is Finalized: "+l(t.isFinalized?"Yes":"No"),1)])],8,V))),128))]),n("div",{class:"create-poll-container"},[n("button",{onClick:D,class:"create-poll-button"}," CREATE NEW POLL ")])]))}},X=C(K,[["__scopeId","data-v-662d63cb"]]);export{X as default};
